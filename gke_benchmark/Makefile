CC=gcc


# Choose your PRNG 
# RLWE_RANDOMNESS_USE_OPENSSL_AES
# RLWE_RANDOMNESS_USE_OPENSSL_RC4
# RLWE_RANDOMNESS_USE_OPENSSL_RAND
# RLWE_RANDOMNESS_USE_DEV_URANDOM
# RLWE_RANDOMNESS_USE_INSECURE_LIBC
#PRNG=RLWE_RANDOMNESS_USE_OPENSSL_AES
PRNG=RLWE_RANDOMNESS_USE_OPENSSL_AES
PRNG_CCFLAGS=
# LDFLAGS needs to have -lcrypto if you are using an OpenSSL-based PRNG
PRNG_LDFLAGS=-lcrypto

# On Mac OS X, the system OpenSSL is too old.  
# Install your own more recent version and point to it.  
# If you have installed OpenSSL via brew, you can use the following two lines.
PRNG_CCFLAGS=-I/usr/local/opt/openssl/include
PRNG_LDFLAGS=-L/usr/local/opt/openssl/lib -lcrypto

CCFLAGS=-O3 -Wall -Wextra -std=c99 -Wno-deprecated-declarations -D$(PRNG) $(PRNG_CCFLAGS) -DCONSTANT_TIME
LDFLAGS=$(PRNG_LDFLAGS)

all:
	$(CC) $(CCFLAGS) -Wno-unused-function -c ../fft.c
	$(CC) $(CCFLAGS) -Wno-unused-function -c ../rlwe.c
	$(CC) $(CCFLAGS) -Wno-unused-function -c ../rlwe_kex.c
	$(CC) $(CCFLAGS) -Wno-unused-function -c clientnserver.c
	$(CC) $(CCFLAGS) -Wno-unused-function -Wno-unused-parameter -c ../rlwe_rand.c
	# $(CC) $(CCFLAGS) -Wno-unused-function -o client clientnserver.c rlwe_kex.o fft.o rlwe.o rlwe_rand.o $(LDFLAGS)
	$(CC) $(CCFLAGS) -o grlwe_benchmark grlwe_benchmark.c fft.o rlwe.o rlwe_kex.o rlwe_rand.o clientnserver.o $(LDFLAGS)
	$(CC) $(CCFLAGS) -o runtimeN runtimeN.c fft.o rlwe.o rlwe_kex.o rlwe_rand.o clientnserver.o $(LDFLAGS)

clean:
	rm fft.o rlwe.o rlwe_rand.o rlwe_kex.o clientnserver.o grlwe_benchmark runtimeN

test:
	./test

prettyprint:
	astyle --style=java --indent=tab --pad-header --pad-oper --align-pointer=name --align-reference=name --suffix=none *.c *.h

